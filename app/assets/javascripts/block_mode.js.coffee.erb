$ ->
  Blockly.HSV_SATURATION = 1.0
  Blockly.HSV_VALUE = 0.8

  Blockly.inject document.getElementById('blockly-div'),
    path: '/blockly/'
    toolbox: document.getElementById('toolbox')
    trashcan: true

  $('#character-modal-character').draggable
    containment: '#character-modal-preview'
    cursor: 'move'
    drag: (event, ui) ->
      pos = ui.position
      $('#character-modal input[name="character[x]"]').val(pos.left * 2).change()
      $('#character-modal input[name="character[y]"]').val(pos.top * 2).change()

  $('#character-modal-preview').droppable
    drop: (event, ui) ->
      pos = ui.draggable.position()
      $('#character-modal input[name="character[x]"]').val(pos.left * 2).change()
      $('#character-modal input[name="character[y]"]').val(pos.top * 2).change()

  $('#character-modal input[name="character[x]"]').change (e) ->
    $('#character_x_value').text($(@).val())

  $('#character-modal input[name="character[y]"]').change (e) ->
    $('#character_y_value').text($(@).val())

  $('#character-modal input[name="character[angle]"]').change (e) ->
    $('#character_angle_value').text("#{$(@).val()}Â°")

  $('#character-modal-costume-selecter a').click (e) ->
    e.preventDefault()
    $('#character-modal-character img').replaceWith($(@).find('img').clone())

  $('#character-modal-ok-button').click (e) ->
    $('#character-modal').modal('hide')
